!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";module.exports=function(e,n,t=function(){}){if(!n.global)return function(e,n,t){const i=e.match(n);return i?t(...i,i.index,i.input).then(t=>e.replace(n,t)):Promise.resolve(e)}(e,n,t);const i=e.match(n);if(!i)return Promise.resolve(e);let o=0,c=0;const r=[],s=new RegExp(n.source,n.flags.replace("g","")),f=[];for(;i.length>0;){const n=i.shift(),l=e.indexOf(n,c);r[o]=e.slice(c,l),o++;let u=o;f.push(t(...n.match(s),l,e).then(e=>{r[u]=e})),c=l+n.length,o++}return r[o]=e.slice(c),Promise.all(f).then(()=>r.join(""))}}));
